---
name: commit
description: Generate conventional commit with Jira linking and semantic-release format
context: fork
agent: git-commit-helper
argument-hint: "[summary and/or AI-XXX references]"
allowed-tools: Bash(git status *), Bash(git diff *), Bash(git log *), Bash(git branch *), Bash(git commit *), Read
---

# Commit Skill

Generate a conventional commit message following project standards.

## Context (Dynamic)

- Current branch: !`git branch --show-current`
- Staged files: !`git diff --cached --name-only`
- Git status: !`git status --short`

## Arguments Provided

$ARGUMENTS

---

## Instructions

### Step 1: Verify Staged Changes

Check if there are staged changes:

```bash
git diff --staged --stat
```

**If no staged changes exist:**
- Report: "No staged changes found. Stage files with `git add <file>` first."
- Exit without creating commit

### Step 2: Analyze Changes

Run analysis commands:

```bash
git diff --staged
git log -1 --oneline 2>/dev/null || echo "No commits yet"
```

Determine:
- **Type**: feat, fix, perf, docs, style, refactor, test, chore
- **Scope**: Affected service/component (e.g., ai-engine, admin-dashboard, shared-data)
- **Subject**: Imperative description of what changed (lowercase, no period)

### Step 3: Extract Jira References

Extract Jira references from TWO sources:

1. **From arguments** (if provided):
   - Pattern: `AI-[1-9][0-9]*`
   - Example: User says `/commit AI-123` or `/commit fixing the auth bug AI-456`

2. **From branch name**:
   ```bash
   git branch --show-current | grep -oE 'AI-[0-9]+' | head -1
   ```

**Resolution rules:**
- If found in args AND branch: Use args (explicit takes precedence)
- If found only in args: Use args
- If found only in branch: Use branch
- If not found anywhere: Omit Jira reference from commit footer

### Step 4: Generate Commit Message

Format:
```
<type>(<scope>): <subject>

<body - explain WHY, not what>

Refs AI-XXX
```

**Rules:**
- Subject: imperative, lowercase, no period, max 100 chars total for first line
- Body: Wrap at 100 chars, explain motivation (optional for small changes)
- Footer: `Refs AI-XXX` or `Closes AI-XXX` (only if Jira ref found)
- **No line may exceed 100 characters**

### Step 5: Validate Against FORBIDDEN Patterns

**SCAN your commit message. If ANY of these appear, REGENERATE:**

| Forbidden Pattern | Example |
|-------------------|---------|
| AI Generation Footer | `Generated with [Claude Code]` |
| Claude Co-Author | `Co-Authored-By: Claude` |
| Anthropic Email | `noreply@anthropic.com` |
| Claude Links | `claude.ai` |
| Anthropic Links | `anthropic.com` |
| Robot Emoji | Lines starting with robot emoji |
| Generic AI Attribution | `Generated by AI`, `AI-assisted`, `AI-generated` |

**Self-Check:** "Does this message contain ANY reference to Claude, Anthropic, AI generation, or robot emojis?" If YES --> Regenerate.

### Step 6: Execute Commit

Use heredoc format to preserve formatting:

```bash
git commit -m "$(cat <<'EOF'
type(scope): subject line here

Body explaining why this change was made.
Keep lines under 100 characters.

Refs AI-XXX
EOF
)"
```

### Step 7: Verify Commit Created

```bash
git log -1 --format="%h %s"
```

Report success with commit hash and subject.

---

## Commit Types Reference

| Type | Purpose | Version Impact |
|------|---------|----------------|
| **feat** | New feature | Minor version bump |
| **fix** | Bug fix | Patch version bump |
| **perf** | Performance improvement | Patch version bump |
| **docs** | Documentation only | No version bump |
| **style** | Formatting, whitespace | No version bump |
| **refactor** | Code restructuring | Minor if scope:core-*, else none |
| **test** | Test changes | No version bump |
| **chore** | Build, dependencies | No version bump (unless deps:*) |

## Scopes Reference

- **Backend**: auth-service, company-service, api-gateway, ai-engine, workflow-engine, data-ingestion, psa-integration, script-management
- **Frontend**: admin-dashboard, web-portal
- **Shared**: shared-common, shared-data, shared-messaging, shared-storage
- **Infrastructure**: docker, database, nginx
- **Cross-cutting**: deps, security, monitoring
- **Meta**: claude-code (for .claude/** changes)

---

## Git Staging Discipline

**Before committing, verify staging is intentional:**

1. Run `git status` to see what is staged
2. Check for suspicious files:
   - Unrelated files from different features
   - Auto-generated files (node_modules/, bin/, obj/, .next/, dist/)
   - Lock files without explicit package changes
   - IDE config files (.idea/, .vscode/)
3. If suspicious files found:
   - List them
   - Suggest: `git restore --staged <file>`
   - Ask for confirmation before proceeding

---

## REMEMBER

- **NO AI ATTRIBUTION** in commit messages
- **NO EMOJI** in commits
- **Jira reference** only if found (don't invent one)
- **DO NOT PUSH** - commit only, user pushes manually
- **100 char max** per line
